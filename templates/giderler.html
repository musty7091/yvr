{% extends "base.html" %}
{% block title %}İşletme Giderleri - YVR{% endblock %}

{% block content %}
<div class="mb-3">
    <a href="/" class="btn btn-outline-secondary btn-sm rounded-pill px-3"><i class="bi bi-arrow-left me-2"></i>Ana Ekrana Dön</a>
</div>

<div class="row mb-4 align-items-center">
    <div class="col-md-7">
        <h3 class="mb-1 text-warning" style="color: #ef6c00 !important;">Gider Takibi</h3>
        <p class="text-muted small mb-0">İşletmenizin kira, personel, fatura vb. harcamaları.</p>
    </div>
    
    <div class="col-md-5 text-md-end mt-3 mt-md-0">
        <button class="btn btn-warning text-white shadow-sm" data-bs-toggle="modal" data-bs-target="#giderEkleModal" style="background-color: #ef6c00; border: none;">
            <i class="bi bi-plus-lg me-2"></i>HARCAMA GİR
        </button>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12">
        <div class="card card-custom p-4 border-0 shadow-sm" style="background: #fff8e1; border-left: 5px solid #ffca28 !important;">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="text-uppercase small fw-bold text-muted mb-1">BU AYKİ TOPLAM GİDER</div>
                    <div class="h2 mb-0" style="color: #ef6c00;">{{ "{:,.2f}".format(bu_ay_toplam) }} ₺</div>
                </div>
                <div class="text-warning opacity-50">
                    <i class="bi bi-wallet2 display-3"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card card-custom p-0 overflow-hidden shadow-sm border-0">
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead style="background-color: #fff8e1;">
                <tr>
                    <th class="ps-4">Tarih</th>
                    <th>Kategori</th>
                    <th>Açıklama</th>
                    <th>Ödenen Hesap</th> <th class="text-end pe-4">Tutar</th>
                    <th class="text-end pe-4">İşlem</th>
                </tr>
            </thead>
            <tbody>
                {% for g in giderler %}
                <tr>
                    <td class="ps-4 text-muted small">
                        {{ g.tarih.strftime('%d.%m.%Y') }}
                    </td>
                    <td>
                        <span class="badge rounded-pill bg-light text-dark border fw-normal px-3">
                            {{ g.kategori }}
                        </span>
                    </td>
                    <td>
                        <div class="text-dark small">{{ g.aciklama }}</div>
                        {% if g.birim != 'TL' %}
                        <div class="text-muted" style="font-size: 0.65rem;">Kur: {{ g.kur_degeri }}</div>
                        {% endif %}
                    </td>
                    <td> <span class="small fw-bold text-primary">
                            <i class="bi bi-bank2 me-1"></i> {{ g.kasa_kaydi.ad if g.kasa_kaydi else 'Belirtilmedi' }}
                        </span>
                    </td>
                    <td class="text-end pe-4 text-danger fw-bold">
                        - {{ "{:,.2f}".format(g.tutar) }} {{ g.birim }}
                    </td>
                    <td class="text-end pe-4">
                        <a href="{{ url_for('gider.gider_sil', id=g.id) }}" onclick="return confirm('Bu harcamayı silmek istediğinize emin misiniz?');" class="btn btn-sm text-muted">
                            <i class="bi bi-trash"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
                {% if not giderler %}
                <tr>
                    <td colspan="6" class="text-center py-5 text-muted small">Kayıtlı gider bulunmamaktadır.</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="giderEkleModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow" style="border-radius: 25px;">
            <div class="modal-body p-5">
                <h5 class="fw-bold mb-4" style="color: #ef6c00;">Yeni Harcama Kaydı</h5>
                <form action="{{ url_for('gider.gider_ekle') }}" method="POST">
                    
                    <div class="mb-3">
                        <label class="form-label small fw-medium text-uppercase">Kategori</label>
                        <select name="kategori" class="form-select bg-light border-0 p-3" required>
                            <option value="Kira">Kira</option>
                            <option value="Personel">Personel Maaş/Avans</option>
                            <option value="Enerji">Elektrik / Su / İnternet</option>
                            <option value="Yemek">Yemek / Mutfak</option>
                            <option value="Akaryakıt">Akaryakıt / Ulaşım</option>
                            <option value="Vergi">Vergi / Muhasebe</option>
                            <option value="Bakım">Bakım / Onarım</option>
                            <option value="Şahsi Çekim">Şahsi Para Çekimi (Kasa Eksilmesi)</option>
                            <option value="Diğer">Diğer</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label small fw-medium text-uppercase">Açıklama</label>
                        <input type="text" name="aciklama" class="form-control bg-light border-0 p-3" placeholder="Örn: 34 ABC 12 Benzin" required>
                    </div>

                    <div class="mb-3"> <label class="form-label small fw-medium text-uppercase">Ödemenin Yapıldığı Hesap</label>
                        <select name="banka_kasa_id" class="form-select bg-light border-0 p-3" required>
                            <option value="">Lütfen hesap seçin...</option>
                            {% for kasa in kasalar %}
                                <option value="{{ kasa.id }}">{{ kasa.ad }} ({{ kasa.tur }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="row">
                        <div class="col-8 mb-4">
                            <label class="form-label small fw-medium text-uppercase">Tutar</label>
                            <input type="number" step="0.01" name="tutar" class="form-control bg-light border-0 p-3" required>
                        </div>
                        <div class="col-4 mb-4">
                            <label class="form-label small fw-medium text-uppercase">Birim</label>
                            <select name="birim" class="form-select bg-light border-0 p-3">
                                <option value="TL">₺ TL</option>
                                <option value="USD">$ USD</option>
                                <option value="EUR">€ EUR</option>
                                <option value="GBP">£ GBP</option>
                            </select>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn text-white w-100 py-3 shadow fw-bold" style="background-color: #ef6c00;">KAYDET</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}